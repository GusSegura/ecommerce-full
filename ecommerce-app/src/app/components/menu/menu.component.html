<nav class="navbar navbar-expand-lg bg-body-tertiary menu-fijo">
  <div class="container-fluid">
    <a routerLink="/"><img class="logo" src="/logoNG.png" alt=""></a>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" routerLink="/mujeres" routerLinkActive="active">Mujeres</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/hombres" routerLinkActive="active">Hombres</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/kids" routerLinkActive="active">Kids</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/accesorios" routerLinkActive="active">Accesorios</a>
        </li>
      </ul>
    </div>
  </div>


  <div class="collapse navbar-collapse iconos">
    <ul class="navbar-nav">

 
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fa-solid fa-magnifying-glass"></i>
        </a>

        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
          <li>
            <div class="px-3 py-2">
                    <input 
                      type="text" 
                      class="form-control buscar" 
                      placeholder="Buscar productos..." 
                      [(ngModel)]="searchTerm" 
                      (input)="onSearchInput()"
                      (keyup.enter)="onSearch()"
                      (blur)="closeResults()"
                    />
                    
                    <!-- Ícono de búsqueda/loading -->
                    <span class="search-icon">
                      <i *ngIf="!isSearching" class="fa fa-search"></i>
                      <i *ngIf="isSearching" class="fa fa-spinner fa-spin"></i>
                    </span>

                    <!-- Resultados en tiempo real -->
                    <div class="search-results" *ngIf="showResults && searchResults.length > 0">
                      <div 
                        *ngFor="let product of searchResults.slice(0, 5)" 
                        class="search-result-item"
                        (mousedown)="selectProduct(product._id)"
                      >
                        <img 
                          [src]="product.imagesUrl?.[0] || '/assets/no-image.png'" 
                          [alt]="product.name"
                          class="result-image"
                        />
                        <div class="result-info">
                          <p class="result-name">{{ product.name }}</p>
                          <p class="result-price">${{ product.price }}</p>
                        </div>
                      </div>
                      
                      <!-- Ver todos los resultados -->
                      <div 
                        class="search-result-item view-all"
                        (mousedown)="onSearch()"
                        *ngIf="searchResults.length > 5"
                      >
                        <i class="fa fa-search"></i>
                        Ver todos los resultados ({{ searchResults.length }})
                      </div>
                    </div>

                    <!-- Mensaje cuando no hay resultados -->
                    <div class="search-results" *ngIf="showResults && searchResults.length === 0 && !isSearching">
                      <div class="search-result-item no-results">
                        <i class="fa fa-exclamation-circle"></i>
                        No se encontraron productos
                      </div>
                    </div>
              
              <ul>
                <li> <a class="dropdown-item" routerLink="/mujeres"> <i class="fa-solid fa-person-dress"></i> Mujeres </a> 
                </li> <li> <a class="dropdown-item" routerLink="/hombres"> <i class="fa-solid fa-person"></i> Hombres </a> 
                </li> <li> <a class="dropdown-item" routerLink="/kids"> <i class="fa-solid fa-baby"></i> Kids </a> </li> 
                <li> <a class="dropdown-item" routerLink="/accesorios"> <i class="fa-solid fa-glasses"></i> Accesorios </a> </li> 
                <li> <a class="dropdown-item" routerLink="/reporte-temporada/primavera"> <i class="fa-solid fa-fan"></i> Primavera </a> 
                </li> <li> <a class="dropdown-item" routerLink="/reporte-temporada/verano"> <i class="fa-solid fa-sun"></i> Verano </a> </li> 
                <li> <a class="dropdown-item" routerLink="/reporte-temporada/otoño"> <i class="fa-solid fa-leaf"></i> Otoño </a> </li> 
                <li> <a class="dropdown-item" routerLink="/reporte-temporada/invierno"> <i class="fa-solid fa-snowflake"></i> Invierno </a> </li>
              </ul>
            </div>
          </li>
        </ul>
      </li>

      <!-- icono Usuario cuando NO está logueado -->
     <li class="nav-item dropdown" *ngIf="!(auth.user$ | async); else logueado">
  <a class="nav-link" (click)="showLoginPopup()" data-cy="login-icon">
    <i class="fa-regular fa-user"></i>
  </a>
</li>

<ng-template #logueado>
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
      <i class="fa-regular fa-user"></i>
    </a>

    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" routerLink="/profile">Perfil</a></li>
      <li><a class="dropdown-item" routerLink="/carrito">Carrito</a></li>
      <!-- @if (isAdmin()) {
        <li>
          <a class="dropdown-item" routerLink="/admin/products">Admin productos</a>
        </li>} -->
        @if (isAdmin()) {          
          <li><a class="dropdown-item" routerLink="/admin/products">Admin de productos</a></li>
          <li><a class="dropdown-item" routerLink="/admin/clients">Gestión de clientes</a></li>
        }
      <li><button class="dropdown-item" (click)="auth.logout()">Cerrar sesión</button></li>      
    </ul>
  </li>
</ng-template>

      <!-- Ícono carrito -->
      <li class="nav-item">
        <a class="nav-link position-relative" routerLink="/carrito">
          <i class="fa-solid fa-cart-shopping"></i>

          @if (cantidadProductos > 0) {
            <span class="position-absolute badge-custom badge rounded-pill bg-danger">
              {{ cantidadProductos }}
            </span>
          }
        </a>
      </li>

    </ul>
  </div>
</nav>
