<br>
<div class="container mt-4">
  <h2>
    <!-- <i class="fas fa-box"></i>  -->
    {{ editMode ? 'Editar Producto' : 'Agregar Nuevo Producto' }}
  </h2>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="mb-5">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Nombre del Producto *</label>
        <input type="text" class="form-control" formControlName="name">
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Precio *</label>
        <input type="number" class="form-control" formControlName="price">
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Stock *</label>
        <input type="number" class="form-control" formControlName="stock">
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Categoría *</label>
        <select class="form-select" formControlName="category">
          <option value="">Selecciona una categoría</option>
          @for (cat of categories; track cat._id) {
  <option [value]="cat._id">{{ cat.name }}</option>
}
        </select>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Temporada *</label>
        <select class="form-select" formControlName="season">
          <option value="">Selecciona temporada</option>
          <option value="primavera">Primavera</option>
          <option value="verano">Verano</option>
          <option value="otono">Otoño</option>
          <option value="invierno">Invierno</option>
        </select>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">URL de Imagen</label>
        <input type="text" class="form-control" formControlName="imagesUrl" 
          placeholder="/ruta/imagen.jpg">
          <!-- <label for="images" class="form-label">Imágenes del producto</label>
          <input 
            type="file" 
            class="form-control" 
            id="images"
            (change)="onFileSelect($event)"
            multiple
            accept="image/*">
          <small class="text-muted">Puedes seleccionar múltiples imágenes</small> -->
      </div>

  <!-- Previsualización de imágenes -->
      @if (imagesPreviews.length > 0) {
      <div class="mb-3">
        <label class="form-label">Vista previa:</label>
        <div class="d-flex gap-2 flex-wrap">
          @for (preview of imagesPreviews; track $index) {
            <div class="position-relative">
              <img [src]="preview" alt="Preview" style="width: 100px; height: 100px; object-fit: cover;">
              <button 
                type="button" 
                class="btn btn-danger btn-sm position-absolute top-0 end-0"
                (click)="removeImage($index)">
                ×
              </button>
            </div>
          }
        </div>
      </div>}

      <div class="col-12 mb-3">
        <label class="form-label">Descripción *</label>
        <textarea class="form-control" rows="3" formControlName="description"></textarea>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success" [disabled]="productForm.invalid">
        <i class="fas fa-save"></i> {{ editMode ? 'Actualizar' : 'Guardar' }}
      </button>
      @if (editMode) {
        <button type="button" class="btn btn-secondary" (click)="resetForm()">
          <i class="fas fa-times"></i> Cancelar
        </button>
      }
    </div>
  </form>

  <hr>
@defer (on timer(3000ms)) {
  <h3>Lista de Productos</h3>
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Categoría</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (product of products; track product._id) {
          <tr>
            <td>{{ product.name }}</td>
            <td>${{ product.price }}</td>
            <td>{{ product.stock }}</td>
            <!-- <td>{{ product.category?.name || 'N/A' }}</td> -->
            <td>{{ getCategoryName(product.category) }}</td>
            <!-- <img [src]="getImageUrl(product.imagesUrl[0])" [alt]="product.name"> -->
            <td>
              <button class="btn btn-sm btn-outline-dark me-2" (click)="editProduct(product)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-dark" (click)="deleteProduct(product._id)">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        }


      </tbody>
    </table>
    <!-- botones de paginacion -->
        <div class="d-flex justify-content-center mt-3 gap-3">
        <button class="btn btn-outline-dark"
                [disabled]="!pagination.hasPrev"
                (click)="loadProducts(pagination.currentPage - 1)">
            ← Anterior
        </button>

        <span class="align-self-center">
            Página {{ pagination.currentPage }} de {{ pagination.totalPages }}
        </span>

        <button class="btn btn-outline-dark"
                [disabled]="!pagination.hasNext"
                (click)="loadProducts(pagination.currentPage + 1)">
            Siguiente →
        </button>
        </div>
        <br>

  </div>
     } @placeholder {
      <p class="text-muted"> Preparando listado de productos...</p>
    } @loading {
      <p class="text-muted">Cargando Productos...</p>
    } @error {
      <p class="text-danger">Error al cargar el formulario.</p>
    }
</div>